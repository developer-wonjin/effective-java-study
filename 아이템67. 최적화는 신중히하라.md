# 아이템67 최적화는 신중히 하라

## 1. Intro:  최적화 vs 좋은 결과 더 중요한 것은?
성능, 속도 vs 견고하게 만든 아키텍쳐

## 2. 토끼와 거북이
- 덜 빠르지만 정확한 정보를 저장하고 출력하는 프로그램
- 설계의 중요성
  - `좋은 프로그램 설계` -> 아키텍쳐가 성능개선에 가이드역할을 해준다.
    - 여러 구성요소로 독립적임.
    - 각 요소별로 다시 설계를 해도 다른 요소에 영향을 주지 않음.
    - 요소별 성능개선이 용이하다.
  - 설계단계에서 성능을 반드시 염두해야함.

## 3. 성능을 제한하는 설계 => 최악
- `변경하기 어려운 시스템`
- (예) API, 네트워크프로토콜, 영구저장용데이터포맷

## 4. API를 설계할 떄 성능에 주는 영향을 고려하라.
- public타입 가변 = 내부데이터를 변경할 수 있게 만들면
  - 불필요한 방어적 복사가 일어남
- 상속을 이용하면 추후 상위클래스의 성능이 하위에 되물림됨.
- 특정 구현체에 종속된 설계보다는 인터페이스를 통한 설계가 더 효율적임.

## 5. 대체로 잘 설계된 API는 성능도 우수하다.

## 6. 성능개선이 어쩔 수 없이 필요하다면?
- 반드시 전후로 성능측정을 기록할 것
- 거의 모든 경우 성능이 눈에 띄게 좋아지지 않는다.
  - 반대로 성능이 나빠지는 경우도 존재
  - 성능이 나빠 90%의 시간을 잡아먹는 코드는 전체코드 중 10%비율이라 찾기가 굉장히 어렵다.
- 프로파일링 도구
  - 최적화가 필요한 위치를 알려줌(선택과 집중)
  - 런타임정보제공
    - 개별메소드 성능측정
    - 호출횟수
  - 알고리즘 교체필요 유무 제공
  - JMH(마이크로 벤치마킹프레임워크)

- `측정의 중요성`
  - 자바의 성능모델은 정교하지 X
     - 자바는 덧셈,곱셈등 기본연산의 비용을 덜 구체적으로 정의함.
     - 기계어와 프로그래밍언어 사이의 추상화격차가 매우 큼
     - 성능측정을 일관성있게 진행하기 어려움.
     - 구현시스템, 릴리즈, 프로세서 마다 비용정의가 각기 다름.
  - 따라서, 자바플랫폼/하드웨어플랫폼 마다 각각 성능측정을 해야함.

## [정리]
1. 설계단계
   - 성능을 고려한 아키텍쳐설계
2. 구현완료
   - 프로파일러를 이용한 성능측정
3. 성능최적화 진행후
   - 또 다시 성능측정진행